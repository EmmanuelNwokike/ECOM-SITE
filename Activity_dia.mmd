%% E-Commerce Application â€” Activity Diagram (Mermaid .mmd)
%% Paste into a Mermaid renderer (Mermaid Live Editor, VS Code, GitHub, etc.)

flowchart TD
  %% Start
  start((Start))

  %% Registration / Login
  start --> authChoice{Have account?}
  authChoice -- No --> register[/"Register: enter name, phone, email,\n postal address, username & password"/]
  register --> regSuccess{Registration successful?}
  regSuccess -- Yes --> loggedIn[/"Logged in (session created)"/]
  regSuccess -- No --> registerFail[/"Show errors -> retry"/]
  registerFail --> register

  authChoice -- Yes --> login[/"Login: username & password"/]
  login --> loginSuccess{Credentials valid?}
  loginSuccess -- Yes --> loggedIn
  loginSuccess -- No --> loginFail[/"Show error -> retry"/]
  loginFail --> login

  %% Browsing and Cart
  loggedIn --> browse[/Browse items (view name, picture, price)/]
  browse --> viewItem["View item details"]
  viewItem --> addCart{"Add to cart?"}
  addCart -- Yes --> addItem[/"Add item to Shopping Cart"/]
  addCart -- No --> browse
  addItem --> cartChoice{Continue shopping or Checkout?}
  cartChoice -- Continue --> browse
  cartChoice -- Checkout --> reviewCart[/"Review Cart: list items,\n update qty, remove items"/]

  %% Option to cancel before payment
  reviewCart --> preCancel{"Cancel order now?"}
  preCancel -- Yes --> cancelledByCustomer1[/"Order cancelled by Customer\n (no payment taken)"/] --> end((End))
  preCancel -- No --> proceedPayment{"Proceed to Payment?"}
  proceedPayment -- No --> browse
  proceedPayment -- Yes --> enterPayment[/"Enter payment details:\n cardholder name, card number,\n expiry, CVV, postal address"/]

  %% Payment & Order creation
  enterPayment --> paymentProcess{Payment valid/authorized?}
  paymentProcess -- No --> paymentFail[/"Payment failed -> show error -> retry or cancel"/]
  paymentFail --> enterPayment
  paymentProcess -- Yes --> createOrder[/"Create Order:\n generate order number,\n record customer name, items,\n total price, postal address"/]
  createOrder --> orderComplete[/"Order completed -> confirmation\n displayed/sent to customer"/]

  %% Post-order flows: delivery / store/customer cancellation
  orderComplete --> monitorOrder["Order in Fulfillment / Delivery"]
  monitorOrder --> cancelDecision{"Cancel order requested?"}
  cancelDecision -- CustomerRequested --> cancelledByCustomer2[/"Order cancelled by Customer\n (refund process if paid)"/] --> end
  cancelDecision -- StoreRequested --> cancelledByStore[/"Order cancelled by Store\n (notify customer, refund if needed)"/] --> end
  cancelDecision -- No --> orderDelivered[/"Order delivered -> Close order"/] --> end

  %% Alternate cancellation path immediately after order creation (fast store cancel)
  createOrder --> storeCancelCheck{"Store cancels immediately?"}
  storeCancelCheck -- Yes --> cancelledByStore
  storeCancelCheck -- No --> orderComplete

  %% End node
  end((End))

  %% Styling (optional - keeps nodes easier to read)
  classDef actions fill:#f9f9f9,stroke:#333,stroke-width:1px;
  class register,login,loggedIn,browse,viewItem,addItem,reviewCart,enterPayment,createOrder,orderComplete,monitorOrder,orderDelivered actions;
